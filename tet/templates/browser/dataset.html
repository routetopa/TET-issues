{% extends "base.html" %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% block title %} {% trans "Dataset details" %} {% endblock title %}

{% block content %}

                <div class="container">

                    <div class="row search-ui">

                        <div class="span3 text-right">

                        </div>

                        <div class="span8 offset1 text-left">

                            <div class="row">

                                {% include "browser/_search.html" with query=query %}

                            </div>

                        </div>

                    </div>

                </div>

                <div class="row">

                    <h4 class="dataset-title"> {{ dataset.title }} </h4>

                </div>
                {% if resource_id %} 
                <div class="row">

                    <script type="text/javascript" src="https://cdn.jsdelivr.net/webcomponentsjs/0.7.16/webcomponents-lite.min.js"></script>
                    <!--<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>-->
                    <!-- REMOVE THE PREVIOUS SCRIPT TAGS IF YOUR PAGE ALREADY USES JQUERY AND POLYFILL LIBRARIES  -->
                    <link rel="import" href="http://deep.routetopa.eu/COMPONENTS/datalets/columnchart-datalet/columnchart-datalet.html" />

                    <div class="span12 -span10 -offset1">
                       
                        <div class="carousel carousel-fade slide" id="main-chart">
                            <div class="carousel-inner">
                                {% for resource in resource_fields %}
                                    <div class="item{% if forloop.counter == 1 %} active{% endif %}">

                                    {% if resource.1 %}
                                       <columnchart-datalet data-url='{{freq_resource_id}}/{{resource.0}}' title="{{resource.0}}" x-axis-label="Range of values in the field {{resource.0}}" y-axis-label="Frequency" filters='[]' aggregators='[]' orders='[]' fields='["result,records,Range","result,records,Frequency"]'></columnchart-datalet>
                                    {% else %}
                                        <columnchart-datalet data-url='{{freq_resource_id}}/{{resource.0}}' title="{{resource.0}}" x-axis-label="Values in {{resource.0}} field" y-axis-label="Number of occurrences" filters='[]' aggregators='[]' orders='[]' fields='["result,records,Value","result,records,Count"]'></columnchart-datalet>
                                    {% endif %}
                                    </div><!-- /Slide1 -->
                                {% endfor %}

                            </div>

                            <div class="control-box">
                                <a data-slide="prev" href="#main-chart" class="carousel-control left">‹</a>
                                <a data-slide="next" href="#main-chart" class="carousel-control right">›</a>
                            </div>
                        </div>

                    </div>

                </div>
                {% endif%}
                <div class="row">

                    <div class="span6">

                        <div class="dataset-description">
                            <h5>
                                <i class="fa fa-file-text-o" aria-hidden="true"></i> {% trans "Description" %}
                            </h5>
                            <p class="text-justify">
                                {{ dataset.notes }}
                            </p>

                        </div>

                        <div class="dataset-metadata">

                            <h5>
                                <i class="fa fa-info-circle" aria-hidden="true"></i> {% trans "Metadata" %}
                            </h5>
                            <div>
                                {{ metadata_box|safe }}
                            </div>

                        </div>


                        <div>
                        <h5>
                            <i class="fa fa-file-text-o" aria-hidden="true"></i> {% trans "Files" %}
                        </h5>
                        <ul class="dataset-files unstyled">
                        {% for resource in dataset.resources %}
                            <li><span class="label result-label" data-format="{{resource.format|lower}}">{{ resource.format }}</span> <a href="{{resource.url}}">{{resource.name}}</a></li>
                        {% endfor %}
                        </ul>
                        </div>
                        {% if fields %}
                            <div>
                                <div class="accordion" id="accordion">
                                    <div class="accordion-group">
                                        <div class="accordion-heading">
                                          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseStruct">
                                             <i class="fa fa-table" aria-hidden="true"></i><b> Table Structure</b>
                                          </a>
                                        </div>
                                        <div id="collapseStruct" class="accordion-body collapse">
                                          <div class="accordion-inner">
                                             <table style="width:100%" border="1">
                                              <tr>
                                                <th>Field Name</th>
                                                <th>Type</th>
                                              </tr>
                                              {% for f in fields %}
                                                  <tr>
                                                    <td> {{f.id}} </td>
                                                    <td> {{f.type}} </td>
                                                  </tr>
                                               {% endfor %}
                                            </table> 
                                          </div>
                                        </div>
                                      </div>
                                </div>
                            </div>
                        {% endif %}
                        <div class="dataset-tags">

                            <h5>
                                <i class="fa fa-tag" aria-hidden="true"></i> {% trans "Tags" %}
                            </h5>
                            <div class="well">
                            {% for tag in dataset.tags %}
                                <span class="label result-label" >{{ tag.display_name }}</span> 
                            {% endfor %}
                            </div>
                            
                        </div>
                        <div>
                        <h5>
                            <i class="fa fa-table" aria-hidden="true"></i> {% trans "Related Datasets" %}
                        </h5>
                        <ul class="dataset-files unstyled">
                        {% for ds in related_datasets %}
                            <li><a href="/{{LANGUAGE_CODE}}/dataset/{{ds.id}}"> {{ds.title}}</a>
                            <div>{{ds.notes}}</div>
                            </li>
                        {% endfor %}
                        </ul>
                        </div>
                    </div>


                    <div class="span6">
                        <div>
                            <h5>
                                <i class="fa fa-eye" aria-hidden="true"></i> {% trans "Available views" %}
                            </h5>

                            <ul class="dataset-services dataset-services-details unstyled">
                                <li class="dataset-service">
                                    {% if dataset.has_table %}
                                    <a href="{% url 'dataset_as_table' dataset.id %}"><i class="fa fa-table" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as table" %}"></i></a>
                                    {% else %}
                                    <a href="#" class="disabled"><i class="fa fa-table" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as table - not available" %}"></i></a>
                                    {% endif %}
                                </li>
                                <li class="dataset-service">
                                    {% if dataset.has_apps %}
                                    <a href="{% url 'dataset_as_app' dataset.id %}" class="disabled"><i class="fa fa-tablet" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as app" %}"></i></a>
                                    {% else %}
                                    <a href="#" class="disabled"><i class="fa fa-tablet" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as app - not available" %}"></i></a>
                                    {% endif %}
                                </li>
                                <li class="dataset-service">
                                    {% if dataset.has_pdf %}
                                    <a href="{% url 'dataset_as_pdf' dataset.id %}"><i class="fa fa-file-pdf-o" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as PDF" %}"></i></a>
                                    {% else %}
                                    <a href="#" class="disabled"><i class="fa fa-file-pdf-o" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as PDF" %}"></i></a>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="span6">

                        <div class="spod-discussions">

                            <h5>
                                <i class="fa fa-comments-o" aria-hidden="true"></i> {% trans "Discussions at SPOD" %}
                            </h5>

                            {% if spod_box_datasets %}
                                {% for dataset in spod_box_datasets %}
                                    {% include "browser/_dataset_discussion.html" with dataset=dataset %}
                                {% endfor %}
                            {% else %}
                            <p>
                                {% trans "This dataset has not been discussed in SPOD, be the first to discuss the dataset!" %}
                            </p>
                            <br/><br/>
                            <p>
                                <a href="{{ SPOD_URL }}/public-room" class="pull-right" data-original-title="" title=""> {% trans "Start the discussion" %}</a>
                            </p>
                            {% endif %}

                        </div>
                    </div>


                </div>



            </div>

{% endblock content %}