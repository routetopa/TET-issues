{% extends "base.html" %}
{% load i18n %}
{% load progress_class %}
{% get_current_language as LANGUAGE_CODE %}
{% block title %} {% trans "Dataset details" %} {% endblock title %}

{% block content %}

                <div class="container">

                    <div class="row search-ui">

                        <div class="span8 offset3 text-left">

                            <div class="row">

                                {% include "browser/_search.html" with query=query %}

                            </div>

                        </div>

                    </div>

                </div>

                <div class="row">

                    <h4 class="dataset-title"> {{ dataset.title }} </h4>

                </div>
                {% if resource_id or dataset.has_pdf %} 
                <div class="row">

                    <script type="text/javascript" src="https://cdn.jsdelivr.net/webcomponentsjs/0.7.16/webcomponents-lite.min.js"></script>
                    <!--<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>-->
                    <!-- REMOVE THE PREVIOUS SCRIPT TAGS IF YOUR PAGE ALREADY USES JQUERY AND POLYFILL LIBRARIES  -->
                    <link rel="import" href="http://deep.routetopa.eu/COMPONENTS/datalets/columnchart-datalet/columnchart-datalet.html" />
                    <link rel="import" href="http://deep.routetopa.eu/COMPONENTS/datalets/datatable-datalet/datatable-datalet.html" /> 
                    <link rel="import" href="http://deep.routetopa.eu/COMPONENTS/datalets/barchart-datalet/barchart-datalet.html" /> 
                    <div class="span12 -span10 -offset1">
                       
                        <div class="carousel carousel-fade slide" id="main-chart">
                            <div class="carousel-inner">
                                {% for resource in resource_fields %}
                                    <div class="item{% if forloop.counter == 1 %} active{% endif %}">

                                    {% if resource.1 %}
                                       <columnchart-datalet data-url='{{freq_resource_id}}/{{resource.0}}' title="{{resource.0}}" x-axis-label="Range of values in the field {{resource.0}}" y-axis-label="Frequency" filters='[]' aggregators='[]' orders='[]' fields='["result,records,Range","result,records,Frequency"]'></columnchart-datalet>
                                    {% else %}
                                        <columnchart-datalet data-url='{{freq_resource_id}}/{{resource.0}}' title="{{resource.0}}" x-axis-label="Values in {{resource.0}} field" y-axis-label="Number of occurrences" filters='[]' aggregators='[]' orders='[]' fields='["result,records,Value","result,records,Count"]'></columnchart-datalet>
                                    {% endif %}
                                    </div><!-- /Slide1 -->
                                {% endfor %}
                                {% if dataset.has_pdf %}
                                    <div class="item {% if not resource_id  %} active {% endif %}">
                                        <barchart-datalet data-url="/en/api/text/{{dataset.id}}/concepts" description="" title="Concepts related to the document" x-axis-label="" y-axis-label="" suffix="" theme="" filters="[]" aggregators="[]" orders="[]" fields='["result,records,Name","result,records,Relevance"]'></barchart-datalet>
                                    </div>
                                    <div class="item">
                                        <barchart-datalet data-url="/en/api/text/{{dataset.id}}/entities" description="" title="Entities related to the document" x-axis-label="" y-axis-label="" suffix="" theme="" filters="[]" aggregators="[]" orders="[]" fields='["result,records,Name","result,records,Relevance"]'></barchart-datalet>
                                    </div>
                                    <div class="item">
                                        <barchart-datalet data-url="/en/api/text/{{dataset.id}}/keywords" description="" title="Keywords related to the document" x-axis-label="" y-axis-label="" suffix="" theme="" filters="[]" aggregators="[]" orders="[]" fields='["result,records,Name","result,records,Relevance"]'></barchart-datalet>
                                    </div>
                                    <div class="item">
                                        <datatable-datalet data-url="/en/api/text/{{dataset.id}}/summary" description="" title="" filters="[]" aggregators="[]" orders="[]" fields='["result,records,Summary"]'></datatable-datalet>
                                    </div>
                                {% endif %}

                            </div>

                            <div class="control-box">
                                <a data-slide="prev" href="#main-chart" class="carousel-control left">‹</a>
                                <a data-slide="next" href="#main-chart" class="carousel-control right">›</a>
                            </div>
                        </div>

                    </div>

                </div>
                {% endif%}



                <div class="row">

                    <ul class="dataset-services-as-divider">
                        <li class="dataset-service">{% trans "View as: " %} </li>
                        <li class="dataset-service">
                            {% if dataset.has_table %}
                            <a href="{% url 'dataset_as_table' dataset.id %}"><i class="fa fa-3x fa-table" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as table" %}"></i></a>
                            {% else %}
                            <a href="#" class="disabled"><i class="fa fa-3x fa-table" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as table - not available" %}"></i></a>
                            {% endif %}
                        </li>
                        <li class="dataset-service">
                            {% if dataset.has_apps %}
                            <a href="{% url 'dataset_as_app' dataset.id %}" class="disabled"><i class="fa fa-3x fa-tablet" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as app" %}"></i></a>
                            {% else %}
                            <a href="#" class="disabled"><i class="fa fa-3x fa-tablet" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as app - not available" %}"></i></a>
                            {% endif %}
                        </li>
                        <li class="dataset-service">
                            {% if dataset.has_pdf %}
                            <a href="{% url 'dataset_as_pdf' dataset.id %}"><i class="fa fa-3x fa-file-pdf-o" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as PDF" %}"></i></a>
                            {% else %}
                            <a href="#" class="disabled"><i class="fa fa-3x fa-file-pdf-o" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as PDF - not available" %}"></i></a>
                            {% endif %}
                        </li>
                    </ul>

                    <span class="clearfix"></span>

                </div>



                <div class="row dataset-details">



                    <div class="row">

                        <div class="span6">

                            <div class="panel panel-dataset">

                                <div class="dataset-description panel-heading">
                                    <h5>
                                        <i class="fa fa-file-text-o" aria-hidden="true"></i> {% trans "Description" %}
                                    </h5>
                                </div>
                                <div class="panel-body dataset-description">
                                    <p class="text-justify">
                                        {{ dataset.notes }}
                                    </p>
                                </div>

                            </div>



                            <div class="panel panel-dataset">

                                <div class="dataset-metadata panel-heading">
                                    <h5>
                                        <i class="fa fa-info-circle" aria-hidden="true"></i> {% trans "Metadata" %}
                                    </h5>
                                </div>
                                <div class="panel-body dataset-description">
                                    <div>
                                        {{ metadata_box|safe }}
                                    </div>
                                </div>

                            </div>



                            <div class="panel panel-dataset">

                                <div class="dataset-quality panel-heading">
                                    <h5>
                                        <i class="fa fa-certificate" aria-hidden="true"></i> {% trans "Dataset Quality" %}
                                    </h5>
                                </div>

                                <div class="panel-body dataset-description top30 span5">
                                    <table class="table table-hover">
                                      <tr>
                                        <th width="35%" class="">{% trans "Indicator" %}</th>
                                        <th width="25%" class="text-center">{% trans "Value" %}</th>
                                        <th>&nbsp;</th>
                                      </tr>

                                          <tr>
                                            <td>
                                                {% trans "Metadata" %}
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {{ completness.metadata|floatformat:"0" }}%
                                                </div>
                                            </td>
                                            <td>
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-{% progress_class completness.metadata %}" role="progressbar" aria-valuenow="{{ completness.metadata }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ completness.metadata }}%;">
                                                        &nbsp;
                                                    </div>
                                                </div>
                                            </td>
                                          </tr>


                                          <tr>
                                            <td>
                                                {% trans "Description" %}
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {{ completness.description|floatformat:"0" }}%
                                                </div>
                                            </td>
                                            <td>
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-small- progress-bar-{% progress_class completness.description %}" role="progressbar" aria-valuenow="{{ completness.description }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ completness.description }}%;">
                                                        &nbsp;
                                                    </div>
                                                </div>
                                            </td>
                                          </tr>


                                          <tr>
                                            <td>
                                                {% trans "Fields" %}
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {{ completness.fields|floatformat:"0" }}%
                                                </div>
                                            </td>
                                            <td>
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-small- progress-bar-{% progress_class completness.fields %}" role="progressbar" aria-valuenow="{{ completness.fields }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ completness.fields }}%;">
                                                        &nbsp;
                                                    </div>
                                                </div>
                                            </td>
                                          </tr>


                                          <tr>
                                            <td>
                                                {% trans "Records" %}
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {{ completness.records|floatformat:"0" }}%
                                                </div>
                                            </td>
                                            <td>
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-small- progress-bar-{% progress_class completness.records %}" role="progressbar" aria-valuenow="{{ completness.records }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ completness.records }}%;">
                                                        &nbsp;
                                                    </div>
                                                </div>
                                            </td>
                                          </tr>


                                          <tr>
                                            <td>
                                                {% trans "Content" %}
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {{ completness.content|floatformat:"0" }}%
                                                </div>
                                            </td>
                                            <td>
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-small- progress-bar-{% progress_class completness.content %}" role="progressbar" aria-valuenow="{{ completness.content }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ completness.content }}%;">
                                                        &nbsp;
                                                    </div>
                                                </div>
                                            </td>
                                          </tr>


                                          <tr>
                                            <td>
                                                {% trans "License" %}
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {% if completness.license %}
                                                        <i class="fa fa-check very-good" aria-hidden="true"></i>
                                                    {% else %}
                                                        <i class="fa fa-times very-poor" aria-hidden="true"></i>
                                                    {% endif %}
                                                </div>
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {% if completness.license %}
                                                        {% trans dataset.license_title %}
                                                    {% else %}
                                                        {% trans "Not provided" %}
                                                    {% endif %}
                                                </div>
                                            </td>
                                          </tr>


                                          <tr>
                                            <td>
                                                    {% trans "Version" %}
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {% if completness.version %}
                                                        <i class="fa fa-check very-good" aria-hidden="true"></i>
                                                    {% else %}
                                                        <i class="fa fa-times very-poor" aria-hidden="true"></i>
                                                    {% endif %}
                                                </div>
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {% if completness.version %}
                                                        {% trans dataset.version %}
                                                    {% else %}
                                                        {% trans "Not provided" %}
                                                    {% endif %}
                                                </div>
                                            </td>
                                          </tr>


                                          <tr>
                                            <td>
                                                {% trans "Last updated" %}
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {{ completness.last_updated }}
                                                </div>
                                            </td>
                                            <td>
                                                <div class="text-center">
                                                    {% trans "days ago" %}
                                                </div>
                                            </td>
                                          </tr>

                                    </table>

                                </div>

                                <span class="clearfix"></span>

                            </div>


                            <div class="panel panel-dataset">

                                <div class="panel-heading">
                                    <h5>
                                        <i class="fa fa-tag" aria-hidden="true"></i> {% trans "Tags" %}
                                    </h5>
                                </div>

                                <div class="panel-body dataset-tags">

                                    {% for tag in dataset.tags %}
                                        <span class="label" >{{ tag.display_name }}</span>
                                    {% endfor %}

                                </div>

                            </div>



                            {% if fields %}
                            <div class="panel panel-dataset">

                                <div class="panel-heading">

                                    <h5>
                                        <i class="fa fa-list" aria-hidden="true"></i> {% trans "Table Structure" %}
                                    </h5>
                                </div>

                                <div class="panel-body top30 span5">
                                    <table class="table table-hover">
                                          <tr>
                                            <th>{% trans "Field name" %}</th>
                                            <th>{% trans "Type" %}</th>
                                          </tr>
                                          {% for f in fields %}
                                              <tr>
                                                <td><code>{{f.id}}</code></td>
                                                <td>{% trans f.type_unified %}</td>
                                              </tr>
                                           {% endfor %}
                                        </table>
                                </div>

                                <span class="clearfix"></span>

                            </div>
                            {% endif %}



                        </div>



                        <div class="span6">
<!--
                            <div>
                                <h5>
                                    <i class="fa fa-eye" aria-hidden="true"></i> {% trans "Available views" %}
                                </h5>

                                <div>
                                    <ul class="dataset-services dataset-services-details unstyled">
                                        <li class="dataset-service">
                                            {% if dataset.has_table %}
                                            <a href="{% url 'dataset_as_table' dataset.id %}"><i class="fa fa-table" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as table" %}"></i></a>
                                            {% else %}
                                            <a href="#" class="disabled"><i class="fa fa-table" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as table - not available" %}"></i></a>
                                            {% endif %}
                                        </li>
                                        <li class="dataset-service">
                                            {% if dataset.has_apps %}
                                            <a href="{% url 'dataset_as_app' dataset.id %}" class="disabled"><i class="fa fa-tablet" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as app" %}"></i></a>
                                            {% else %}
                                            <a href="#" class="disabled"><i class="fa fa-tablet" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as app - not available" %}"></i></a>
                                            {% endif %}
                                        </li>
                                        <li class="dataset-service">
                                            {% if dataset.has_pdf %}
                                            <a href="{% url 'dataset_as_pdf' dataset.id %}"><i class="fa fa-file-pdf-o" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as PDF" %}"></i></a>
                                            {% else %}
                                            <a href="#" class="disabled"><i class="fa fa-file-pdf-o" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as PDF" %}"></i></a>
                                            {% endif %}
                                        </li>
                                    </ul>

                                    <span class="clearfix"></span>

                                </div>

                            </div>
-->


                            <div class="panel panel-dataset">

                                <div class="panel-heading">

                                    <h5>
                                        <i class="fa fa-share-square-o" aria-hidden="true"></i> {% trans "Share this page" %}
                                    </h5>

                                </div>

                                <div class="panel-body">

                                    {% trans "Use the icons below in order to share this page in your favourite Social Media." %}

                                    <div id="social-sharing"></div>

                                </div>

                            </div>



                            <div class="panel panel-dataset">

                                <div class="panel-heading">

                                    <h5>
                                        <i class="fa fa-comments-o" aria-hidden="true"></i> {% trans "Discussions at SPOD" %}
                                    </h5>

                                </div>

                                <div class="panel-body">

                                    {% if spod_box_datasets %}
                                        {% for dataset in spod_box_datasets %}
                                            {% include "browser/_dataset_discussion.html" with dataset=dataset %}
                                        {% endfor %}
                                    {% else %}
                                    <p>
                                        {% trans "This dataset has not been discussed in SPOD, be the first to discuss the dataset!" %}
                                    </p>
                                    <br/><br/>
                                    <p>
                                        <a href="{{ SPOD_URL }}/public-room" class="pull-right" data-original-title="" title=""> {% trans "Start the discussion" %}</a>
                                    </p>
                                    {% endif %}

                                    <span class="clearfix"></span>

                                </div>

                            </div>



                            <div class="panel panel-dataset">

                                <div class="panel-heading">

                                    <h5>
                                        <i class="fa fa-link" aria-hidden="true"></i> {% trans "Related Datasets" %}
                                    </h5>

                                </div>

                                <div class="panel-body">

                                    <ul class="dataset-files">
                                    {% for ds in related_datasets %}
                                        <li>
                                            <a href="/{{LANGUAGE_CODE}}/dataset/{{ds.id}}" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{{ds.notes|truncatewords:16}}"> {{ds.title}}</a>
                                            <!-- <div> {{ds.notes|truncatewords:8}} </div> -->
                                        </li>
                                    {% endfor %}
                                    </ul>

                                </div>

                            </div>



                            <div class="panel panel-dataset">

                                <div class="panel-heading">

                                    <h5>
                                        <i class="fa fa-file-text-o" aria-hidden="true"></i> {% trans "Files" %}
                                    </h5>

                                </div>

                                <div class="panel-body">

                                    <ul class="dataset-files unstyled">
                                    {% for resource in dataset.resources %}
                                        <li> <span class="label" data-format="{{resource.format|lower}}">{{ resource.format }}</span> <a href="{{resource.url}}"> <i class="fa fa-external-link" aria-hidden="true"></i> {{resource.name}}</a></li>
                                    {% endfor %}
                                    </ul>

                                </div>

                            </div>



                        </div>

                    </div>

                </div>

{% endblock content %}
