{% extends "base.html" %}

{% load i18n %}

{% block title %} Dataset details {% endblock title %}

{% block content %}

                <div class="container">

                    <div class="row search-ui">

                        <div class="span8 offset3 text-left">

                            <div class="row">

                                {% include "browser/_search.html" with query=query %}

                            </div>

                        </div>

                    </div>

                </div>

                <div class="row">

                    <h4 class="dataset-title"> {{ dataset.title }} <small>{% trans "Tabular View" %}</small></h4>
                    <h5 class="dataset-title">  </h5>

                </div>


                <div class="row">
                    <div>

                        <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation" class="active"><a href="#explorer" aria-controls="explorer" role="tab" data-toggle="tab">{% trans "Data Explorer" %}</a></li>
                            <li role="presentation"><a href="#pivottable" aria-controls="pivottable" role="tab" data-toggle="tab">{% trans "PivotTable" %}</a></li>
                             <li role="presentation"><a href="#sqlquery" aria-controls="sqlquery" role="tab" data-toggle="tab">{% trans "SQL Query" %}</a></li>
                            <!--<li role="presentation"><a href="#discuss" aria-controls="discuss" role="tab" data-toggle="tab">{% trans "SPOD Discussion" %}</a></li>-->
                        </ul>

                        <div class="tab-content">

                            <div role="tabpanel" class="tab-pane active" id="explorer">
                                <iframe width="100%" height="350" src="{{url_table}}" frameBorder="0"></iframe>
                            </div>

                            <div role="tabpanel" class="tab-pane" id="pivottable">
                                <iframe width="100%" height="350" src="{{url_pivottable}}" frameBorder="0"></iframe>
                            </div>

                            <div role="tabpanel" class="tab-pane" id="sqlquery">
                               <div id="query-editor" style="height: 100px;">SELECT  * from "{{ resource_id }}" LIMIT 10</div>
                               <div>
                                    <input id="query-api" type="hidden" value="{{ QUERY_API }}"/>
                                    <button id="exe-query" type="button" class="btn btn-primary pull-right">Run</button>
                                </div>
                                <div>
                                    <div id="query-output"></div>
                                </div>
                            </div>
<!--
                            <div role="tabpanel" class="tab-pane" id="discuss">

                            </div>
-->
                        </div>

                    </div>
                </div>


                <div class="row top30">

                    <div class="span8">
                        {% include "browser/_dataset_api_box.html" with API_LINK=API_LINK %}
                    </div>

                    <div class="span4 top30">

                        <ul class="dataset-services-as-divider">
                            <li class="dataset-service">{% trans "View as: " %} </li>
                            <li class="dataset-service">
                                <a href="{% url 'dataset' dataset.id %}"><i class="fa fa-3x fa-bar-chart" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as chart" %}"></i></a>
                            </li>
                            <li class="dataset-service">
                                <a href="{% url 'dataset_as_summary' dataset.id %}"><i class="fa fa-3x fa-lightbulb-o" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View the summary" %}"></i></a>
                            </li>
                            <li class="dataset-service">
                                {% if dataset.has_apps %}
                                <a href="{% url 'dataset_as_app' dataset.id %}"><i class="fa fa-3x fa-tablet" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as app" %}"></i></a>
                                {% else %}
                                <a href="#" class="disabled"><i class="fa fa-3x fa-tablet" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as app - not available" %}"></i></a>
                                {% endif %}
                            </li>
                            <li class="dataset-service">
                                {% if dataset.has_pdf %}
                                <a href="{% url 'dataset_as_pdf' dataset.id %}"><i class="fa fa-3x fa-file-pdf-o" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as PDF" %}"></i></a>
                                {% else %}
                                <a href="#" class="disabled"><i class="fa fa-3x fa-file-pdf-o" aria-hidden="true" data-toggle="tooltip" data-placement="bottom" title="{% trans "View as PDF - not available" %}"></i></a>
                                {% endif %}
                            </li>
                        </ul>

                        <span class="clearfix"></span>

                    </div>

                </div>


                <div class="row">

                    <div class="span6">


                        <div class="panel panel-dataset">

                            <div class="panel-heading">
                                <h5>
                                    <i class="fa fa-file-text-o" aria-hidden="true"></i>
                                    {% trans "Description" %}
                                </h5>
                            </div>

                            <div class="panel-body dataset-description">
                                <p class="text-justify">
                                    {{ dataset.notes }}
                                </p>
                            </div>

                        </div>

                        <div class="panel panel-dataset">

                            <div class="panel-heading dataset-metadata">
                                <h5>
                                    <i class="fa fa-info-circle" aria-hidden="true"></i>
                                    {% trans "Metadata" %}
                                </h5>
                            </div>

                            <div class="panel-body">
                                {{ metadata_box|safe }}
                            </div>

                        </div>

                    </div>


                    <div class="span6">

                        <div class="panel panel-dataset">

                            <div class="panel-heading">

                                <h5>
                                    <i class="fa fa-comments-o" aria-hidden="true"></i> {% trans "Discussions at SPOD" %}
                                </h5>
                            </div>

                            <div class="panel-body">

                                {% if spod_box_datasets %}
                                    {% for dataset in spod_box_datasets %}
                                        {% include "browser/_dataset_discussion.html" with dataset=dataset %}
                                    {% endfor %}
                                {% else %}
                                <p>
                                    {% trans "This dataset has not been discussed in SPOD, be the first to discuss the dataset!" %}
                                </p>
                                <br/><br/>
                                <p>
                                    <a href="{{ SPOD_URL }}/public-room" class="pull-right" data-original-title="" title=""> {% trans "Start the discussion" %}</a>
                                </p>
                            {% endif %}

                            </div>

                            <span class="clearfix"></span>

                        </div>

                    </div>

                </div>


            </div>

{% endblock content %}